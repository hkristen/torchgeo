# This config replicates the results of the ChangeVit paper on the LEVIR-CD dataset.
model:
  class_path: ChangeDetectionTask
  init_args:
    model: 'changevit_tiny'
    task: 'binary'
    loss: 'bce'
    lr: 2e-4
    num_classes: 2
data:
  class_path: LEVIRCDDataModule
  init_args:
    batch_size: 16
    patch_size: 224
    num_workers: 4
    model: 'changevit_tiny'
  dict_kwargs:
    root: 'data'

trainer:
  max_steps: 80000
  accelerator: auto
  devices: 1
  val_check_interval: 28
  log_every_n_steps: 10
  callbacks:
    - class_path: lightning.pytorch.callbacks.ModelCheckpoint
      init_args:
        monitor: 'val_BinaryF1Score'
        mode: 'max'
        save_top_k: 3
        filename: 'changevit_s_levircd_{step}_{val_BinaryF1Score:.4f}'
    - class_path: lightning.pytorch.callbacks.LearningRateMonitor
      init_args:
        logging_interval: 'step'

optimizer:
  class_path: torch.optim.Adam
  init_args:
    lr: 2e-4
    betas: [0.9, 0.99]
    weight_decay: 1e-4

lr_scheduler:
  class_path: torch.optim.lr_scheduler.PolynomialLR
  init_args:
    total_iters: 80000
    power: 0.9
